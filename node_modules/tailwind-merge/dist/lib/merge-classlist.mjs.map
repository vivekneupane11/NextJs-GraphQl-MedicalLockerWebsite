{"version":3,"file":"merge-classlist.mjs","sources":["../../src/lib/merge-classlist.ts"],"sourcesContent":["import { ConfigUtils } from './config-utils'\n\nconst SPLIT_CLASSES_REGEX = /\\s+/\nconst IMPORTANT_MODIFIER = '!'\n\nexport function mergeClassList(classList: string, configUtils: ConfigUtils) {\n    const { getClassGroupId, getConflictingClassGroupIds } = configUtils\n\n    /**\n     * Set of classGroupIds in following format:\n     * `{importantModifier}{variantModifiers}{classGroupId}`\n     * @example 'float'\n     * @example 'hover:focus:bg-color'\n     * @example 'md:!pr'\n     */\n    const classGroupsInConflict = new Set<string>()\n\n    return (\n        classList\n            .trim()\n            .split(SPLIT_CLASSES_REGEX)\n            .map((originalClassName) => {\n                const { modifiers, hasImportantModifier, baseClassName } =\n                    splitModifiers(originalClassName)\n\n                const classGroupId = getClassGroupId(baseClassName)\n\n                if (!classGroupId) {\n                    return {\n                        isTailwindClass: false as const,\n                        originalClassName,\n                    }\n                }\n\n                const variantModifier = sortModifiers(modifiers).join('')\n\n                const modifierId = hasImportantModifier\n                    ? variantModifier + IMPORTANT_MODIFIER\n                    : variantModifier\n\n                return {\n                    isTailwindClass: true as const,\n                    modifierId,\n                    classGroupId,\n                    originalClassName,\n                }\n            })\n            .reverse()\n            // Last class in conflict wins, so we need to filter conflicting classes in reverse order.\n            .filter((parsed) => {\n                if (!parsed.isTailwindClass) {\n                    return true\n                }\n\n                const { modifierId, classGroupId } = parsed\n\n                const classId = `${modifierId}${classGroupId}`\n\n                if (classGroupsInConflict.has(classId)) {\n                    return false\n                }\n\n                classGroupsInConflict.add(classId)\n\n                getConflictingClassGroupIds(classGroupId).forEach((group) =>\n                    classGroupsInConflict.add(`${modifierId}${group}`)\n                )\n\n                return true\n            })\n            .reverse()\n            .map((parsed) => parsed.originalClassName)\n            .join(' ')\n    )\n}\n\nfunction splitModifiers(className: string) {\n    const modifiers = []\n\n    let bracketDepth = 0\n    let modifierStart = 0\n\n    for (const match of className.matchAll(/[:[\\]]/g)) {\n        if (match[0] === ':') {\n            if (bracketDepth === 0) {\n                const nextModifierStart = match.index! + 1\n                modifiers.push(className.substring(modifierStart, nextModifierStart))\n                modifierStart = nextModifierStart\n            }\n        } else if (match[0] === '[') {\n            bracketDepth++\n        } else if (match[0] === ']') {\n            bracketDepth--\n        }\n    }\n\n    const baseClassNameWithImportantModifier =\n        modifiers.length === 0 ? className : className.substring(modifierStart)\n    const hasImportantModifier = baseClassNameWithImportantModifier.startsWith(IMPORTANT_MODIFIER)\n    const baseClassName = hasImportantModifier\n        ? baseClassNameWithImportantModifier.substring(1)\n        : baseClassNameWithImportantModifier\n\n    return {\n        modifiers,\n        hasImportantModifier,\n        baseClassName,\n    }\n}\n\n/**\n * Sorts modifiers according to following schema:\n * - Predefined modifiers are sorted alphabetically\n * - When an arbitrary variant appears, it's important to preserve which modifiers are before and after it\n */\nfunction sortModifiers(modifiers: string[]) {\n    if (modifiers.length <= 1) {\n        return modifiers\n    }\n\n    const sortedModifiers = []\n    let unsortedModifiers: string[] = []\n\n    modifiers.forEach((modifier) => {\n        const isArbitraryVariant = modifier[0] === '['\n\n        if (isArbitraryVariant) {\n            sortedModifiers.push(...unsortedModifiers.sort(), modifier)\n            unsortedModifiers = []\n        } else {\n            unsortedModifiers.push(modifier)\n        }\n    })\n\n    sortedModifiers.push(...unsortedModifiers.sort())\n\n    return sortedModifiers\n}\n"],"names":["SPLIT_CLASSES_REGEX","IMPORTANT_MODIFIER","mergeClassList","classList","configUtils","getClassGroupId","getConflictingClassGroupIds","classGroupsInConflict","Set","trim","split","map","originalClassName","splitModifiers","modifiers","hasImportantModifier","baseClassName","classGroupId","isTailwindClass","variantModifier","sortModifiers","join","modifierId","reverse","filter","parsed","classId","has","add","forEach","group","className","bracketDepth","modifierStart","matchAll","match","nextModifierStart","index","push","substring","baseClassNameWithImportantModifier","length","startsWith","sortedModifiers","unsortedModifiers","modifier","isArbitraryVariant","sort"],"mappings":"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"}